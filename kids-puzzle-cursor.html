
<!DOCTYPE html>
<html>

<head>
    <meta charset="utf8">
    <title>Kids puzzle - Play with Leap Motion</title>
    <script src="http://js.leapmotion.com/leap-0.6.4.js"></script>
    <style>
        body {
            padding: 0;
            margin: 0;
        }
        
        .hole{
            border: 1px solid grey;
        }
        
        .piece {
            background-size: calc(210px *2) calc(210px *2);
        }

        .hole, .piece {
            position: absolute;
            width: 210px;
            height: 210px;
        }

        #piece1 {
            background-position: 0 0;
        }
        
        #piece2 {
            background-position: 100% 0;
        }
        
        #piece3 {
            background-position: 0% 100%;
        }
        
        #piece4 {
            background-position: 100% 100%;
        }
        
        .selected {
            opacity: 0.5;
            -webkit-filter: drop-shadow(0px 0px 50px #222);
            filter: drop-shadow(0px 0px 50px #222);
            width: 250px;
            height: 250px;
        }
        
        #cursor {
            width: 150px;
            height: 122.25px;
            opacity: 0.8;
            -webkit-filter: drop-shadow(0px 0px 10px #222);
            filter: drop-shadow(0px 0px 10px #222);
            background-image: url('images/cursor.png');
            background-size: cover;
            position: absolute;
            top: 0;
            left: 0;
        }
        
        h3 {
            text-align: center;
            font-family: "Comic Sans MS";
        }
    </style>
</head>

<body>
    <h3>Hover over a piece to select it, then hover right where it should go<br/>Swipe left or right to switch between puzzles</h3>
    <div id="hole1" class="hole"></div>
    <div id="hole2" class="hole"></div>
    <div id="hole3" class="hole"></div>
    <div id="hole4" class="hole"></div>
    <div id="piece1" class="piece"></div>
    <div id="piece2" class="piece"></div>
    <div id="piece3" class="piece"></div>
    <div id="piece4" class="piece"></div>
    <div id="cursor"></div>
    <script>
        var hole1 = document.getElementById("hole1");
        var hole2 = document.getElementById("hole2");
        var hole3 = document.getElementById("hole3");
        var hole4 = document.getElementById("hole4");
        var piece1 = document.getElementById("piece1");
        var piece2 = document.getElementById("piece2");
        var piece3 = document.getElementById("piece3");
        var piece4 = document.getElementById("piece4");
        var cursor = document.getElementById("cursor");

        var levelQty = 4;
        var pieceQty = 4;

        var currentLevel = 1;
        var currentPiece = null;

        var correctPieces = 0;

        var holesTopMargin = 150;
        var holesLeftMargin = 150;
        var piecesTopMargin = 150;
        var piecesLeftMargin = 700;
        var pieceWidth = 420/2;
        var pieceHeight = 420/2;
        var padding = 10;

        function loadHoles(){
            hole1.style.top = holesTopMargin + "px";
            hole1.style.left = holesLeftMargin + "px";

            hole2.style.top = holesTopMargin + "px";
            hole2.style.left = holesLeftMargin + pieceWidth + padding + "px";

            hole3.style.top = holesTopMargin + pieceHeight + padding + "px";
            hole3.style.left = holesLeftMargin + "px";

            hole4.style.top = holesTopMargin + pieceHeight + padding + "px";
            hole4.style.left = holesLeftMargin + pieceWidth + padding + "px";
        }

        function loadPieces() {
            var pieces = document.getElementsByClassName('piece');
            if (pieces.length > 0 && currentLevel <= levelQty)
                for (var i = 0; i < pieces.length; i++) {
                    pieces[i].style.backgroundImage = "url('images/puzzles/" + currentLevel + ".jpg')";
                }

            var scrambledPieces = [piece1, piece2, piece3, piece4];
            shuffleArray(scrambledPieces);

            scrambledPieces[0].style.top = piecesTopMargin + "px";
            scrambledPieces[0].style.left = piecesLeftMargin + "px";

            scrambledPieces[1].style.top = piecesTopMargin + "px";
            scrambledPieces[1].style.left = piecesLeftMargin + pieceWidth + padding + "px";

            scrambledPieces[2].style.top = piecesTopMargin + pieceHeight + padding + "px";
            scrambledPieces[2].style.left = piecesLeftMargin + "px";

            scrambledPieces[3].style.top = piecesTopMargin + pieceHeight + padding + "px";
            scrambledPieces[3].style.left = piecesLeftMargin + pieceWidth + padding + "px";
        }

        function shuffleArray(o) {
            for (var j, x, i = o.length; i; j = Math.floor(Math.random() * i), x = o[--i], o[i] = o[j], o[j] = x);
            return o;
        }

        function checkPieces(x, y) {
            if (x > piece1.offsetLeft && x < (piece1.offsetLeft + piece1.offsetWidth)) {
                if (y > piece1.offsetTop && y < (piece1.offsetTop + piece1.offsetHeight)) {
                    // piece1
                    selectPiece(piece1);
                } else if (y > piece3.offsetTop && y < (piece3.offsetTop + piece3.offsetHeight)) {
                    // piece3
                    selectPiece(piece3);
                }
            } else if (x > piece2.offsetLeft && x < (piece2.offsetLeft + piece2.offsetWidth)) {
                if (y > piece2.offsetTop && y < (piece2.offsetTop + piece2.offsetHeight)) {
                    // piece2
                    selectPiece(piece2);
                } else if (y > piece4.offsetTop && y < (piece4.offsetTop + piece4.offsetHeight)) {
                    // piece4
                    selectPiece(piece4);
                }
            }
        }

        function selectPiece(piece) {
            currentPiece = piece;
            piece.className += ' selected';
            cursor.style.backgroundImage = "url('images/cursorAlt.png')";
        }

        function checkHoles(x, y) {
            if (x > hole1.offsetLeft && x < (hole1.offsetLeft + hole1.offsetWidth)) {
                if (y > hole1.offsetTop && y < (hole1.offsetTop + hole1.offsetHeight)) {
                    // hole1
                    if (currentPiece == piece1) {
                        placePieceOverHole(piece1, hole1);
                    }
                } else if (y > hole3.offsetTop && y < (hole3.offsetTop + hole3.offsetHeight)) {
                    // hole3
                    if (currentPiece == piece3) {
                        placePieceOverHole(piece3, hole3);
                    }
                }
            } else if (x > hole2.offsetLeft && x < (hole2.offsetLeft + hole2.offsetWidth)) {
                if (y > hole2.offsetTop && y < (hole2.offsetTop + hole2.offsetHeight)) {
                    // hole2
                    if (currentPiece == piece2) {
                        placePieceOverHole(piece2, hole2);
                    }
                } else if (y > hole4.offsetTop && y < (hole4.offsetTop + hole4.offsetHeight)) {
                    // hole4
                    if (currentPiece == piece4) {
                        placePieceOverHole(piece4, hole4);
                    }
                }
            }
        }

        function placePieceOverHole(piece, hole) {
            piece.style.top = hole.style.top;
            piece.style.left = hole.style.left;
            piece.className = 'piece'; //leave only this css classes
            currentPiece = null;
            correctPieces += 1;
            cursor.style.backgroundImage = "url('images/cursor.png')";
        }

        function nextLevel() {
            // go to next level
            var nextLevel = (currentLevel == levelQty) ? 1 : currentLevel + 1;
            goToLevel(nextLevel);
        }

        function previousLevel() {
            // go to previous level
            var previousLevel = (currentLevel == 1) ? levelQty : currentLevel - 1;
            goToLevel(previousLevel);
        }

        function goToLevel(newLevel) {
            currentLevel = newLevel;
            currentPiece = null;
            correctPieces = 0;
            loadPieces();
        }

        var controllerOptions = {
            enableGestures: true
        };
        Leap.loop(controllerOptions, function(frame) {

            if (frame.gestures.length > 0) {
                for (var i = 0; i < frame.gestures.length; i++) {
                    var gesture = frame.gestures[i];
                    if (gesture.type == "swipe") {
                        //Classify swipe as either horizontal or vertical
                        var isHorizontal = Math.abs(gesture.direction[0]) > Math.abs(gesture.direction[1]);
                        //Classify as right or left
                        if (isHorizontal) {
                            if (gesture.direction[0] > 0) {
                                // swipeDirection = "right";
                                previousLevel();
                            } else {
                                // swipeDirection = "left";
                                nextLevel();
                            }
                        }
                    }
                }
            }

            var interactionBox = frame.interactionBox;

            if (frame.pointables.length > 0) {
                //Leap coordinates
                var tipPosition = frame.pointables[0].tipPosition;

                //Normalized coordinates
                var normalizedPosition = interactionBox.normalizePoint(tipPosition, true);

                //Pixel coordinates in current window
                var windowPosition = [normalizedPosition[0] * window.innerWidth,
                    window.innerHeight - (normalizedPosition[1] * window.innerHeight),
                    0
                ];
                var x = windowPosition[0];
                var y = windowPosition[1];

                //Update cursor position
                cursor.style.marginLeft = x + "px";
                cursor.style.marginTop = y + "px";

                if (currentPiece != null) {
                    //Check whether the selected piece should go in the current hovering spot
                    checkHoles(x, y);
                } else if (correctPieces < pieceQty) {
                    //Show selected piece underneath cursor
                    currentPiece.style.marginLeft = Math.round(x / 2) + "px";
                    currentPiece.style.marginTop = Math.round(y / 2) + "px";
                    //Check whether there's a piece to select in the current hovering spot
                    checkPieces(x, y);
                } else if (correntPieces == pieceQty) {
                    //Go to next level
                    nextLevel();
                }
            }
        });

        window.onload = function() {
            loadHoles();
            loadPieces();
        }
    </script>
</body>

</html>